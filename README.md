Сокращатель ссылок на MEAN
---

### Описание проекта
Для реализации был выбран стек MEAN (MongoDB, Express.js, Angular, Node.js)
api запускается параллельно с интерфейсом, обмен данными происходит путем POST запросов.

### Системные требования:
Node.js с поддержкой async/await (> 7.6)  
установленная в системе MongoDB

### Загрузка общих зависимостей:
> npm install
### Запуск api (3000 порт)
> запустить mongoDB  
> npm run start:server
### Запуск интерфейса (4200 порт)
> ng serve -o

### Реализованные функции

* регистрация пользователя
* создание неотслеживаемой сокращенной ссылки (для анонимного пользователя)
* создание отслеживаемой сокращенной ссылки (для вошедшего пользователя)
* отображение ссылок, сокращенных вошедшим пользователем, со статистикой переходов
* переход с короткой ссылки на длинную

### Страницы интерфейса
/ - форма ввода ссылки с указанием протокола. 
/login - страница входа в
/signup - страница регистрация нового пользователя
/statistics - страница отслеживаемых ссылок 
/:shortLink - редирект на соответствующую страницу

### Схема БД
Хранение ссылки:
```
{
  link: {type: String, required: true}, // исходная ссылка
  shortLink: {type: String, required: true}, // короткая ссылка
  anonymous: {type: Boolean, required: true}, // true для неавторизованного пользователя
  authorId: {type: mongoose.Schema.Types.ObjectId, ref: "User", required: false}, // id пользователя, создавшего неанонимную ссылку
  clickCounter: {type: Number, required: true, default: 0} // счетчик переходов неанонимной ссылки
}
```

### Алгоритм работы

Создание короткой ссылки для <longLink>:  
Если (пользователь вошел под <userId>)  
----То поиск {link: <longLink>, anonymous: false, authorId: <userId>}  
--------Если <longLink> найдена, возвращение соответствующей shortLink  
--------Иначе добавление в БД  
Иначе  
----Поиск анонимной записи {link: <longLink>, anonymous: true}  
--------Если <longLink> найдена, возвращение соответствующей shortLink  
--------Иначе добавление в БД  

### Оптимизация

Для оптимизации основного сценария использования (открытия короткой ссылки) -
необходимо оптимизировать скорость поиска ссылки с заданной shortLink.
Для этого, для коллекции links был построен индекс:
({"shortLink":1},{"unique",1}) - возрастающий и уникальный

При тестировании запущенного api при помощи wrk, отправлялся запрос с фиксированным shortLink. Api работало с такой же скоростью как и без индексов, причина была определена не сразу и судя по всему в том, что при поиске определенной записи в коллекции, mongoDB сохраняет результат на следующие n запросов.
Поэтому проверка времени поиска определенной записи в коллекции, измерена средствами mongoDB.
При помощи запроса вида: db.links.find({shortLink:'zipERL'}).explain("executionStats")

Результат:  
БД: локальная  
Коллекция: 1млн записей  
Индекс: отсутствует.
```
"executionStats" : {
		"executionSuccess" : true,
		"nReturned" : 1,
		"executionTimeMillis" : 637, // <--
		"totalKeysExamined" : 0,
		...
}
```

Индекс: shortLink_1.
```
"executionStats" : {
		"executionSuccess" : true,
		"nReturned" : 1,
		"executionTimeMillis" : 10, // <--
		"totalKeysExamined" : 1,
		"totalDocsExamined" : 1,
		….
}
```



